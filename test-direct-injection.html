<!DOCTYPE html>
<html>
<head>
    <title>Direct Data Injection Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .status-indicator {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #ff0000;
            color: white;
            padding: 20px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 14px;
            z-index: 99999;
            max-width: 500px;
            word-wrap: break-word;
            box-shadow: 0 0 20px rgba(255,0,0,0.8);
        }
        .success-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #00ff00;
            color: black;
            padding: 20px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 14px;
            z-index: 99999;
            max-width: 500px;
            word-wrap: break-word;
            box-shadow: 0 0 20px rgba(0,255,0,0.8);
        }
        .log-entry {
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            margin: 5px 0;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .test-logs {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö® Direct Data Injection Test</h1>
        <p>This page tests direct data injection into 5GLabX components without relying on any service loading.</p>

        <div class="test-section">
            <h2>üß™ Test Controls</h2>
            <button onclick="testDirectInjection()">Test Direct Injection</button>
            <button onclick="testEventDispatch()">Test Event Dispatch</button>
            <button onclick="testDOMInjection()">Test DOM Injection</button>
            <button onclick="testMultipleEvents()">Test Multiple Events</button>
            <button onclick="clearLogs()">Clear Test Logs</button>
        </div>

        <div class="test-section">
            <h2>üìä Test Logs</h2>
            <div id="test-logs" class="test-logs"></div>
        </div>

        <div class="test-section">
            <h2>üîß Manual Commands</h2>
            <p>Copy and paste these commands into the browser console:</p>
            <pre id="console-commands"></pre>
        </div>

        <div class="test-section">
            <h2>üìù Instructions</h2>
            <ol>
                <li><strong>Open this page</strong> in your browser (http://localhost:3000/test-direct-injection.html or just open the file)</li>
                <li><strong>Click "Test Direct Injection"</strong> to inject test data</li>
                <li><strong>Look for red indicator</strong> in top-left corner showing "DIRECT INJECTION ACTIVE"</li>
                <li><strong>Check 5GLabX components</strong> for new log entries</li>
                <li><strong>Monitor console</strong> for detailed logging</li>
                <li><strong>If no data appears</strong>, try the manual console commands</li>
            </ol>
        </div>
    </div>

    <script>
        // Test data
        const testData = {
            testCaseId: 'direct-injection-test',
            testCaseData: {
                id: 'direct-injection-test',
                name: 'Direct Data Injection Test',
                description: 'Test case with direct data injection',
                protocol: '5G_NR',
                category: '5G_NR',
                expectedMessages: [
                    {
                        id: 'direct_msg_1',
                        stepOrder: 1,
                        timestampMs: Date.now(),
                        direction: 'UL',
                        layer: 'RRC',
                        protocol: '5G_NR',
                        messageType: 'RRCSetupRequest',
                        messageName: 'RRC Setup Request',
                        messageDescription: 'Direct injection test message',
                        messagePayload: {
                            rrc_TransactionIdentifier: 1,
                            establishmentCause: 'mo_Signalling'
                        },
                        informationElements: {
                            'RRC Transaction Identifier': { type: 'INTEGER', value: 1 },
                            'Establishment Cause': { type: 'ENUMERATED', value: 'mo-Signalling' }
                        },
                        layerParameters: {
                            'Protocol': { value: 'RRC', reference: 'TS 38.331' }
                        },
                        standardReference: 'TS 38.331'
                    },
                    {
                        id: 'direct_msg_2',
                        stepOrder: 2,
                        timestampMs: Date.now() + 1000,
                        direction: 'DL',
                        layer: 'RRC',
                        protocol: '5G_NR',
                        messageType: 'RRCSetup',
                        messageName: 'RRC Setup',
                        messageDescription: 'Direct injection test message 2',
                        messagePayload: {
                            rrc_TransactionIdentifier: 1,
                            radioBearerConfig: {}
                        },
                        informationElements: {
                            'RRC Transaction Identifier': { type: 'INTEGER', value: 1 },
                            'Radio Bearer Config': { type: 'SEQUENCE', value: 'Present' }
                        },
                        layerParameters: {
                            'RRC Setup': { value: 'Success', reference: 'TS 38.331' }
                        },
                        standardReference: 'TS 38.331'
                    }
                ]
            },
            source: 'DirectInjectionTest',
            timestamp: Date.now()
        };

        // Log function
        function addLog(message, type = 'info') {
            const logsContainer = document.getElementById('test-logs');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.style.color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            logEntry.textContent = '[' + new Date().toLocaleTimeString() + '] ' + message;
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
            console.log(message);
        }

        // Test direct injection
        function testDirectInjection() {
            addLog('üî• Testing direct injection...', 'info');

            // Create test logs
            const directLogs = testData.testCaseData.expectedMessages.map((msg, index) => ({
                id: `direct-${Date.now()}-${index}`,
                timestamp: (Date.now() / 1000).toFixed(1),
                level: 'I',
                component: msg.layer || 'TEST',
                message: `${msg.messageName}: ${JSON.stringify(msg.messagePayload || {}, null, 2)}`,
                type: msg.messageType || 'TEST_MESSAGE',
                source: 'DirectInjection',
                testCaseId: testData.testCaseId,
                direction: msg.direction || 'UL',
                protocol: msg.protocol || '5G_NR',
                rawData: JSON.stringify(msg.messagePayload || {}, null, 2),
                informationElements: msg.informationElements || {},
                layerParameters: msg.layerParameters || {}
            }));

            addLog(`‚úÖ Generated ${directLogs.length} test logs`, 'success');

            // Show red indicator
            showIndicator('DIRECT INJECTION ACTIVE', directLogs.length);

            // Dispatch multiple events
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    window.dispatchEvent(new CustomEvent('immediate-logs-update', {
                        detail: { logs: directLogs, source: 'DirectInjection' }
                    }));

                    window.dispatchEvent(new CustomEvent('5GLABX_TEST_EXECUTION', {
                        detail: { testCaseId: testData.testCaseId, testCaseData: testData.testCaseData, logs: directLogs }
                    }));

                    window.dispatchEvent(new CustomEvent('logs-update', {
                        detail: { logs: directLogs, source: 'DirectInjection' }
                    }));

                    addLog(`üì° Dispatched events - attempt ${i + 1}`, 'info');
                }, i * 200);
            }

            // Try to inject into existing elements
            setTimeout(() => {
                injectIntoDOMElements(directLogs);
            }, 500);
        }

        // Test event dispatch only
        function testEventDispatch() {
            addLog('üî• Testing event dispatch only...', 'info');

            const testLogs = [
                {
                    id: 'event-test-1',
                    timestamp: (Date.now() / 1000).toFixed(1),
                    level: 'I',
                    component: 'TEST',
                    message: 'Event dispatch test message: ' + new Date().toLocaleTimeString(),
                    type: 'TEST_MESSAGE',
                    source: 'EventTest',
                    testCaseId: 'event-test',
                    direction: 'UL',
                    protocol: '5G_NR'
                }
            ];

            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    window.dispatchEvent(new CustomEvent('immediate-logs-update', {
                        detail: { logs: testLogs, source: 'EventDispatch' }
                    }));
                    addLog(`üì° Event dispatch attempt ${i + 1}`, 'info');
                }, i * 100);
            }
        }

        // Test DOM injection only
        function testDOMInjection() {
            addLog('üî• Testing DOM injection only...', 'info');

            const testLogs = testData.testCaseData.expectedMessages.map((msg, index) => ({
                id: `dom-${Date.now()}-${index}`,
                timestamp: (Date.now() / 1000).toFixed(1),
                level: 'I',
                component: msg.layer || 'TEST',
                message: `DOM INJECTION: ${msg.messageName}`,
                type: msg.messageType || 'TEST_MESSAGE',
                source: 'DOMInjection',
                testCaseId: testData.testCaseId,
                direction: msg.direction || 'UL',
                protocol: msg.protocol || '5G_NR'
            }));

            injectIntoDOMElements(testLogs);
        }

        // Test multiple events
        function testMultipleEvents() {
            addLog('üî• Testing multiple event types...', 'info');

            const testLogs = testData.testCaseData.expectedMessages.map((msg, index) => ({
                id: `multi-${Date.now()}-${index}`,
                timestamp: (Date.now() / 1000).toFixed(1),
                level: 'I',
                component: msg.layer || 'TEST',
                message: `MULTI-EVENT: ${msg.messageName}`,
                type: msg.messageType || 'TEST_MESSAGE',
                source: 'MultiEvent',
                testCaseId: testData.testCaseId,
                direction: msg.direction || 'UL',
                protocol: msg.protocol || '5G_NR'
            }));

            // Dispatch different event types
            const events = [
                { name: 'immediate-logs-update', detail: { logs: testLogs, source: 'MultiEvent' } },
                { name: '5GLABX_TEST_EXECUTION', detail: { testCaseId: testData.testCaseId, testCaseData: testData.testCaseData, logs: testLogs } },
                { name: 'logs-update', detail: { logs: testLogs, source: 'MultiEvent' } },
                { name: 'test-data-update', detail: { logs: testLogs, source: 'MultiEvent' } },
                { name: 'enhanced-logs-update', detail: { logs: testLogs, source: 'MultiEvent' } }
            ];

            events.forEach((event, index) => {
                setTimeout(() => {
                    window.dispatchEvent(new CustomEvent(event.name, { detail: event.detail }));
                    addLog(`üì° Dispatched ${event.name} event`, 'info');
                }, index * 200);
            });
        }

        // Inject into DOM elements
        function injectIntoDOMElements(logs) {
            addLog('üîç Looking for DOM elements to inject into...', 'info');

            // Look for log containers
            const selectors = [
                '[class*="log"]',
                '[class*="logs"]',
                '[data-testid*="log"]',
                '.logs-view',
                '.enhanced-logs',
                '[id*="log"]'
            ];

            let foundElements = 0;

            selectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach((element, index) => {
                    foundElements++;
                    addLog(`üîç Found element: ${selector} (${element.className || element.id})`, 'info');

                    try {
                        logs.forEach((log, logIndex) => {
                            const logDiv = document.createElement('div');
                            logDiv.style.cssText = 'color: blue; font-weight: bold; padding: 5px; margin: 2px; border: 1px solid blue; background: #f0f8ff;';
                            logDiv.textContent = `DOM INJECT: ${log.message.substring(0, 80)}...`;
                            element.appendChild(logDiv);
                        });
                        addLog(`‚úÖ Injected ${logs.length} logs into element`, 'success');
                    } catch (e) {
                        addLog(`‚ùå Failed to inject into element: ${e.message}`, 'error');
                    }
                });
            });

            if (foundElements === 0) {
                addLog('‚ö†Ô∏è No suitable DOM elements found for injection', 'error');
            }
        }

        // Show indicator
        function showIndicator(message, logCount) {
            // Remove existing indicators
            const existing = document.querySelectorAll('.status-indicator, .success-indicator');
            existing.forEach(el => el.remove());

            // Create red indicator
            const indicator = document.createElement('div');
            indicator.className = 'status-indicator';
            indicator.innerHTML = `
                <strong>üö® DIRECT INJECTION ACTIVE</strong><br>
                Test Case: ${testData.testCaseData.name}<br>
                Logs: ${logCount}<br>
                Time: ${new Date().toLocaleTimeString()}<br>
                Status: INJECTING DATA NOW
            `;

            document.body.appendChild(indicator);

            // Remove after 10 seconds
            setTimeout(() => {
                if (indicator.parentNode) {
                    indicator.parentNode.removeChild(indicator);
                }
            }, 10000);

            addLog('‚úÖ Visual indicator created', 'success');
        }

        // Clear logs
        function clearLogs() {
            document.getElementById('test-logs').innerHTML = '';
            addLog('üßπ Test logs cleared', 'info');
        }

        // Initialize
        window.addEventListener('load', () => {
            addLog('üöÄ Direct injection test page loaded', 'info');

            // Set up console commands
            const commandsContainer = document.getElementById('console-commands');
            commandsContainer.textContent = `// Test direct injection
directDataInjection();

// Manual event dispatch
window.dispatchEvent(new CustomEvent('immediate-logs-update', {
  detail: { logs: ${JSON.stringify(testData.testCaseData.expectedMessages.map((msg, i) => ({
    id: `manual-${Date.now()}-${i}`,
    timestamp: (Date.now() / 1000).toFixed(1),
    level: 'I',
    component: msg.layer,
    message: msg.messageName + ': ' + JSON.stringify(msg.messagePayload),
    type: msg.messageType,
    source: 'ManualTest'
  })))}, source: 'ManualTest' }
}));

// Check for log containers
document.querySelectorAll('[class*=log]').forEach(el =>
  console.log('Log element:', el.className, el.innerHTML.length)
);`;

            addLog('‚úÖ Page initialized and ready for testing', 'success');
        });

        // Make functions globally available
        window.testDirectInjection = testDirectInjection;
        window.testEventDispatch = testEventDispatch;
        window.testDOMInjection = testDOMInjection;
        window.testMultipleEvents = testMultipleEvents;
        window.clearLogs = clearLogs;
        window.testData = testData;

        console.log('üöÄ Direct injection test page ready!');
        console.log('üìã Available functions: testDirectInjection(), testEventDispatch(), testDOMInjection(), testMultipleEvents(), clearLogs()');
    </script>
</body>
</html>